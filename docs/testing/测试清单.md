# AutoRepo 功能测试清单

**测试日期**: ________________  
**测试人员**: ________________  
**微信开发者工具版本**: ________________

---

## 测试准备

### 环境设置
- [ ] 后端服务已启动 (`uvicorn main:app --reload --port 8001`)
- [ ] 微信开发者工具已打开项目
- [ ] 已清除缓存并重新编译
- [ ] 已有至少 1 个测试车辆数据

### 测试数据准备
- [ ] 创建测试车辆："测试车 A"（用于模板和导出测试）
- [ ] 创建跨月份的提交记录（用于趋势图测试）：
  - 2025-08: 3 条记录
  - 2025-09: 2 条记录
  - 2025-10: 4 条记录
  - 2025-11: 1 条记录
  - 2025-12: 3 条记录
  - 2026-01: 2 条记录

---

## 功能 1：保养模板系统

### 1.1 模板显示测试

**测试步骤**：
1. 打开微信开发者工具
2. 导航到任意车辆详情页
3. 点击右下角 "+" 按钮，进入创建提交页面
4. 查看页面顶部的模板选择器

**验证点**：
- [ ] 模板选择器横向滚动流畅
- [ ] 显示 10 个模板卡片
- [ ] 每个模板显示图标 + 名称
- [ ] 模板卡片样式正确（圆角、背景色）

**模板清单验证**：
- [ ] 1. 🛢️ 更换机油
- [ ] 2. 🚗 轮胎换位
- [ ] 3. 🌬️ 更换空气滤清器
- [ ] 4. 🛑 更换刹车片
- [ ] 5. ⚙️ 四轮定位
- [ ] 6. ⚡ 更换火花塞
- [ ] 7. 🔋 更换电池
- [ ] 8. 🧊 冷却液更换
- [ ] 9. 🎵 改装音响
- [ ] 10. 📋 年检

### 1.2 模板选择功能测试

**测试步骤**：
1. 在创建提交页面
2. 点击第 1 个模板「🛢️ 更换机油」
3. 观察表单字段变化

**验证点**：
- [ ] 标题字段自动填充为「更换机油」
- [ ] 类型选择器自动选中「保养」
- [ ] 零件费用自动填充（应为 200-300 元范围）
- [ ] 人工费用自动填充（应为 50-100 元范围）
- [ ] 显示成功提示 Toast「已应用模板」
- [ ] 选中的模板卡片高亮显示（深色背景）

### 1.3 不同类型模板测试

**测试不同类型**：

**保养类模板**（例如：轮胎换位）：
- [ ] 点击模板后，类型选择器显示「保养」

**维修类模板**（例如：更换刹车片）：
- [ ] 点击模板后，类型选择器显示「维修」

**改装类模板**（例如：改装音响）：
- [ ] 点击模板后，类型选择器显示「改装」

### 1.4 编辑功能测试

**测试步骤**：
1. 选择任意模板
2. 手动修改标题、费用等字段
3. 填写里程数和备注
4. 点击「提交」

**验证点**：
- [ ] 模板填充后仍可手动编辑所有字段
- [ ] 修改后的数据正确保存
- [ ] 后端收到正确的数据
- [ ] 车辆详情页显示新提交记录

---

## 功能 2：CSV 导出与分享

### 2.1 导出按钮显示测试

**测试步骤**：
1. 导航到任意车辆详情页
2. 确保在「时间线」标签页
3. 查看「整备记录」标题右侧

**验证点**：
- [ ] 显示导出按钮（📊 导出）
- [ ] 按钮样式正确（渐变背景）
- [ ] 按钮可点击

### 2.2 CSV 文件生成测试

**测试步骤**：
1. 确保当前车辆有至少 5 条提交记录
2. 点击「导出」按钮
3. 观察加载状态

**验证点**：
- [ ] 显示「生成中...」加载提示
- [ ] 1-2 秒内生成完成
- [ ] 弹出确认对话框「导出成功，是否分享 CSV 文件？」
- [ ] 对话框有两个按钮：「分享」和「稍后」

### 2.3 CSV 文件内容验证

**测试步骤**：
1. 点击「分享」按钮
2. 在微信中分享给「文件传输助手」
3. 在电脑端下载 CSV 文件
4. 使用 Excel 或 WPS 打开文件

**验证点**：

**文件名格式**：
- [ ] 文件名包含车辆名称
- [ ] 文件名包含「维保记录」
- [ ] 文件名包含日期（YYYY-MM-DD 格式）
- [ ] 示例：`测试车A_维保记录_2026-01-27.csv`

**文件编码**：
- [ ] 中文字符正确显示（无乱码）
- [ ] UTF-8 编码正确（Excel 识别）

**表头**：
- [ ] 列标题：日期、类型、标题、里程(km)、零件费用(元)、人工费用(元)、总费用(元)、备注

**数据行验证**（随机抽取 3 条）：

记录 1：
- [ ] 日期格式正确（YYYY-MM-DD）
- [ ] 类型正确（保养/维修/改装）
- [ ] 标题正确
- [ ] 里程数字正确
- [ ] 零件费用正确
- [ ] 人工费用正确
- [ ] 总费用 = 零件费用 + 人工费用
- [ ] 备注内容正确

记录 2：
- [ ] （同上验证点）

记录 3：
- [ ] （同上验证点）

**特殊字符处理**：
- [ ] 备注中包含逗号的记录正确转义（用引号包裹）
- [ ] 备注中包含引号的记录正确转义（双引号）

### 2.4 分享功能测试

**场景 1：选择「分享」**：
- [ ] 显示微信分享对话框
- [ ] 可以分享给好友/群聊
- [ ] 分享成功显示「分享成功」提示

**场景 2：选择「稍后」**：
- [ ] 对话框关闭
- [ ] 显示「已保存到本地」提示
- [ ] 文件保存在小程序本地目录

**场景 3：分享失败降级**：
- [ ] 如果分享 API 不可用，自动降级到「打开文档」
- [ ] 文档查看器正确打开 CSV 文件

### 2.5 边界情况测试

**无记录导出**：
- [ ] 车辆无任何提交记录时点击导出
- [ ] 显示「暂无记录可导出」提示
- [ ] 不生成文件

**大量记录导出**：
- [ ] 导出 50+ 条记录
- [ ] 生成时间 < 3 秒
- [ ] 文件完整，无数据丢失

---

## 功能 3：月度趋势图表

### 3.1 趋势图显示测试

**测试步骤**：
1. 导航到车辆详情页
2. 切换到「数据统计」标签页
3. 向下滚动，查看「趋势分析」部分

**验证点**：
- [ ] 显示「趋势分析（最近6个月）」标题
- [ ] 显示两个图表区域：月度花费 + 里程变化
- [ ] 如果数据不足 6 个月，显示实际可用月份
- [ ] 如果无数据，趋势分析部分不显示

### 3.2 费用趋势图验证

**测试步骤**：
1. 查看「月度花费」图表
2. 对比实际提交记录

**验证点**：

**柱状图样式**：
- [ ] 柱子颜色为蓝色渐变
- [ ] 柱子高度与费用成正比
- [ ] 最高费用的柱子高度最大
- [ ] 柱子顶部圆角

**标签显示**：
- [ ] 每个柱下方显示月份（例如：「08月」）
- [ ] 每个柱下方显示金额（例如：「¥450」）

**数据准确性验证**（至少验证 3 个月）：

2025-08月：
- [ ] 柱高度正确
- [ ] 金额标签 = 该月所有记录的总费用
- [ ] 手动计算验证：________ 元（预期）vs ________ 元（实际）

2025-09月：
- [ ] （同上验证点）

2025-10月：
- [ ] （同上验证点）

### 3.3 里程趋势图验证

**测试步骤**：
1. 查看「里程变化」图表
2. 对比实际提交记录

**验证点**：

**柱状图样式**：
- [ ] 柱子颜色为深色渐变（与费用图不同）
- [ ] 柱子高度与里程成正比
- [ ] 最高里程的柱子高度最大

**标签显示**：
- [ ] 每个柱下方显示月份
- [ ] 每个柱下方显示里程（例如：「12500km」）

**数据准确性验证**（至少验证 3 个月）：

2025-08月：
- [ ] 里程值 = 该月记录的最大里程数
- [ ] 手动验证：________ km（预期）vs ________ km（实际）

2025-09月：
- [ ] （同上验证点）

2025-10月：
- [ ] （同上验证点）

### 3.4 趋势图交互测试

**测试步骤**：
1. 下拉刷新页面
2. 观察趋势图重新加载

**验证点**：
- [ ] 下拉刷新时，趋势图数据更新
- [ ] 加载状态正确显示
- [ ] 刷新后数据与后端一致

### 3.5 后端 API 测试（可选）

**测试步骤**：
1. 打开浏览器或 Postman
2. 访问：`http://localhost:8001/api/repos/{repo_id}/trends?months=6`
3. 查看返回的 JSON 数据

**验证点**：
- [ ] 响应状态码：200
- [ ] 返回 JSON 格式正确
- [ ] `months` 数组包含月度数据
- [ ] 每个月包含：month, cost, mileage, count
- [ ] 数据按月份升序排列

**示例响应**：
```json
{
  "months": [
    {"month": "2025-08", "cost": 450, "mileage": 5200, "count": 2},
    {"month": "2025-09", "cost": 820, "mileage": 10400, "count": 3}
  ],
  "total_months": 6
}
```

---

## 综合测试

### 端到端流程测试

**完整用户旅程**：
1. [ ] 创建新车辆
2. [ ] 使用模板创建 3 条保养记录（不同月份）
3. [ ] 手动创建 2 条维修记录
4. [ ] 导出 CSV 并在 Excel 中验证
5. [ ] 查看数据统计页的趋势图
6. [ ] 验证所有数据一致性

### 性能测试

- [ ] 模板选择响应 < 100ms
- [ ] CSV 导出（50 条记录）< 2 秒
- [ ] 趋势图加载 < 500ms
- [ ] 页面切换无卡顿

### 兼容性测试

- [ ] 微信开发者工具中正常运行
- [ ] 真机预览正常（如有条件）
- [ ] 不同分辨率设备显示正常

---

## 缺陷记录

### 发现的问题

| 编号 | 功能模块 | 问题描述 | 严重程度 | 状态 |
|------|---------|---------|---------|------|
| 1    |         |         | □严重 □一般 □轻微 |      |
| 2    |         |         | □严重 □一般 □轻微 |      |
| 3    |         |         | □严重 □一般 □轻微 |      |

### 问题详情

**问题 1**：
- 重现步骤：
- 预期结果：
- 实际结果：
- 截图/日志：

---

## 测试结论

### 功能测试结果

- [ ] **保养模板系统**: ✅ 通过 / ❌ 不通过 / ⚠️ 部分通过
- [ ] **CSV 导出与分享**: ✅ 通过 / ❌ 不通过 / ⚠️ 部分通过
- [ ] **月度趋势图表**: ✅ 通过 / ❌ 不通过 / ⚠️ 部分通过

### 总体评价

□ **可以发布** - 所有功能测试通过，无严重缺陷  
□ **需要修复** - 发现严重缺陷，需要修复后重新测试  
□ **需要优化** - 功能正常，但有性能或体验问题需要优化

### 测试人员签名

测试完成时间：________________  
测试人员签名：________________

---

## 附录：自动化验证脚本使用

### 运行自动化验证

1. 在微信开发者工具中打开项目
2. 打开控制台（Console）
3. 执行以下代码：

```javascript
const validator = require('./test/feature-validation.js');
validator.runAllValidations();
```

### 单独测试某个功能

```javascript
const validator = require('./test/feature-validation.js');

// 仅测试模板系统
validator.validateTemplateSystem();

// 仅测试 CSV 导出
validator.validateCSVExporter();

// 仅测试趋势图表
validator.validateTrendCharts();
```

---

**测试清单版本**: 1.0  
**最后更新**: 2026-01-27
