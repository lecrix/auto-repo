# AutoRepo 测试指南

本指南包含快速测试流程、完整功能测试清单以及针对最新功能的专项测试。

**最后更新**: 2026-01-28 (保险功能重构 + 里程显示优化)

---

## 📋 第-1部分：🆕 2026-01-28 保险功能测试 (10分钟)

### 前置条件

- 后端运行: `uvicorn main:app --reload --port 8001`
- 前端已编译并在微信开发者工具中运行

### 测试清单

#### 1. 保险记录创建与自动计算

- [ ] 进入"新建记录"页面，选择"车辆保险"类型
- [ ] ✅ **验证1**: 显示保险专属字段（保险公司、交强险费用、商业险费用）
- [ ] ✅ **验证2**: **不显示**保单号、起保日期、到期日期字段
- [ ] 输入交强险费用：950元
- [ ] ✅ **验证3**: 底部"总费用"自动更新为950元
- [ ] 输入商业险费用：3050元
- [ ] ✅ **验证4**: 底部"总费用"自动更新为4000元（950+3050）
- [ ] 提交记录
- [ ] ✅ **验证5**: 保存成功，无500错误

#### 2. 保险记录编辑预填充

- [ ] 进入刚创建的保险记录详情页
- [ ] 点击"编辑"按钮
- [ ] ✅ **验证**: 保险公司、交强险费用、商业险费用正确预填充

#### 3. 筛选功能类型列表

- [ ] 在车辆详情页进入时间线标签
- [ ] 点击类型筛选下拉框
- [ ] ✅ **验证**: 显示9个选项（全部类型 + 8种记录类型）
- [ ] ✅ **验证**: 包含"车辆保险"选项
- [ ] 选择"车辆保险"筛选
- [ ] ✅ **验证**: 只显示保险类型的记录

#### 4. 里程显示逻辑

- [ ] 在车辆详情页查看顶部卡片
- [ ] ✅ **验证1**: 显示"总里程"标签（非"行驶里程"）
- [ ] ✅ **验证2**: 数值为车辆当前总里程（如25000km）
- [ ] 切换到"数据统计"标签
- [ ] ✅ **验证3**: 第二个指标卡显示"行驶里程"
- [ ] ✅ **验证4**: 数值为购车后行驶距离（如20000km = 25000 - 5000初始里程）
- [ ] ✅ **验证5**: "每公里成本"基于行驶里程计算

#### 5. 无里程记录创建

- [ ] 创建保险记录，**不填写**里程字段
- [ ] 提交记录
- [ ] ✅ **验证**: 保存成功，无报错（修复了之前的500错误）

---

## 📋 第零部分：🆕 2026-01-27 第二轮Bug修复验证 (15分钟)

### 前置条件

- 后端运行: `uvicorn main:app --reload --port 8000`
- 前端已编译并在微信开发者工具中运行

### 测试清单

#### 1. Bug #1: 编辑记录预填充

- [X] 创建一条保养记录（任意类型）
- [X] 进入记录详情页，点击"编辑"按钮
- [X] ✅ **验证**: 所有字段已预填充（标题、类型、日期、里程、费用、备注）
- [X] 修改任意字段（如费用），保存
- [X] ✅ **验证**: 返回详情页，修改已生效

#### 2. Bug #2: 日期选择器（无时间）

- [X] 进入"新建记录"页面
- [X] ✅ **验证**: 只显示日期选择器，**没有**时间选择器
- [X] 选择日期后提交
- [X] ✅ **验证**: 记录的时间戳为所选日期的00:00:00

#### 3. Bug #3: CSV导出费用

- [X] 在车辆详情页创建至少2条包含费用的记录
- [X] 点击"导出CSV"按钮
- [X] 打开导出的.xls文件（用Excel或文本编辑器）
- [X] ✅ **验证**: 零件费用和人工费用列显示实际数值（非0）

#### 4. Bug #4: 图表显示

- [X] 在数据统计页面查看"月度花费"和"月度里程"图表
- [X] ✅ **验证1**: 最高的柱子高度接近100%（不会超出或被截断）
- [X] ✅ **验证2**: 月份标签显示"1月"、"2月"（不是"01月"、"02月"）
- [X] ✅ **验证3**: 所有柱子高度相对正确（与数值成比例）

#### 5. Bug #5: 时间线卡片

- [X] 在车辆详情页查看整备记录时间线
- [X] ✅ **验证**: 每个卡片的meta区域显示"¥XX"（总费用）和日期
- [X] ✅ **验证**: **不显示**类似"507f1f77bcf86cd799439011"的ID

#### 6. Bug #6: 模板系统

- [ ] 进入"新建记录"页面
- [ ] ✅ **验证1**: 模板选择器顺序为：保养 → 维修 → 改装 → 整备 → 保险
- [ ] 选择"保险"类型模板
- [ ] ✅ **验证2**: 显示保险专属字段（保险类型、公司、保单号、起保/到期日期）
- [ ] ✅ **验证3**: 只有一个"总费用"输入框（不再分parts和labor）

#### 7. Bug #7: 里程标签一致性

- [ ] 检查以下页面的里程字段标签：
  - repo-create: ✅ "总里程 (km)"
  - repo-detail头部: ✅ "行驶里程"
  - commit-create: ✅ "记录里程 (km)"
  - insights-view统计: ✅ "总里程 (累计)"
  - insights-view图表: ✅ "月度里程"
- [ ] ✅ **验证**: 标签清晰区分，无混淆

#### 8. Bug #8: 购车费用统计

- [ ] 创建新车辆，填写"购车价格"（如50000元）
- [ ] 添加1-2条保养记录（各花费500元）
- [ ] 进入数据统计页面
- [ ] ✅ **验证**: "总成本"显示为 50000 + 保养费用总和

#### 9. Bug #9: 帮助图标位置

- [ ] 进入车辆列表页（repo-list）
- [ ] ✅ **验证**: 右上角帮助图标（❓）完全可见，不被导航栏遮挡
- [ ] 点击图标，确认弹窗正常显示

---

## 📋 第一部分：快速测试执行指南 (15-20 分钟)

**所有功能已实现完毕！** 现在请按以下步骤进行快速验证。

### 1. 准备工作

- **启动后端**: `cd backend && uvicorn main:app --reload --port 8001`
- **打开工具**: 微信开发者工具导入 `auto-repo/miniprogram`
- **清除缓存**: 工具 -> 清除缓存 -> 清除全部缓存

### 2. 核心流程验证

- **模板系统**: 进入创建提交页，点击「🛢️ 更换机油」，验证表单自动填充。
- **CSV 导出**: 在车辆详情页点击「📊 导出」，验证生成 `.xls` 文件并可分享。
- **趋势图表**: 在数据统计页查看「趋势分析」，验证柱状图显示正常。

---

## 📋 第二部分：完整功能测试清单

### 1. 保养模板系统

- [ ] 模板选择器横向滚动流畅，显示 12 个模板（包含新增的燃油和停车费）。
- [ ] 点击模板后，标题、类型、费用自动填充。
- [ ] **新增**: 模板描述自动填充到备注字段。
- [ ] 模板填充后仍可手动编辑所有字段。

### 2. CSV 导出与分享

- [ ] 导出按钮样式正确，位于时间线标题右侧。
- [ ] 生成文件名为 `{车辆名}_维保记录_{日期}.xls`。
- [ ] **新增**: 验证文件后缀为 `.xls` 以确保微信兼容性。
- [ ] Excel 打开后中文字符无乱码，数据准确。

### 3. 月度趋势图表

- [ ] 显示最近 6 个月的费用和里程趋势。
- [ ] 柱子高度与数值成正比，带有月份和数值标签。
- [ ] 下拉刷新后数据同步更新。

---

## 📋 第三部分：🆕 新增功能测试 (Bug 修复验证)

### 1. 日期时间选择

- [ ] `commit-create` 页面显示日期选择器。
- [ ] `commit-create` 页面显示时间选择器。
- [ ] 修改日期时间后提交，验证记录显示的时间与选择一致。

### 2. 编辑删除功能

- [ ] `commit-detail` 页面显示「编辑」按钮。
- [ ] 点击编辑跳转到编辑页面，表单预填充原有数据。
- [ ] 修改数据并保存，验证详情页实时更新。
- [ ] `commit-detail` 页面显示「删除」按钮。
- [ ] 点击删除显示确认对话框，确认后记录被移除并返回列表。

### 3. 里程可选与计算

- [ ] `commit-create` 页面里程字段标记为「可选」。
- [ ] 不填写里程提交记录，验证保存成功且详情页显示正常。
- [ ] 验证详情页显示的行驶里程为「当前里程 - 初始里程」。

### 4. 购车成本与颜色

- [ ] `repo-create` 页面显示「购车价格」字段。
- [ ] 填写购车价格并保存，验证车辆信息中正确记录。
- [ ] 切换车辆自定义颜色，验证详情页头部背景色同步变化。

### 5. 帮助手册

- [ ] `repo-list` 页面右上角显示帮助图标。
- [ ] 点击图标弹出帮助模态框，内容涵盖 Git 概念说明。

---

## 🧪 性能与兼容性

- [ ] 页面切换无明显卡顿。
- [ ] 所有图片和图标加载正常。
- [ ] 在不同尺寸的模拟器下布局无错位。

**测试完成日期**: 2026-01-27
**测试结论**: [ ] 通过 / [ ] 需修复
