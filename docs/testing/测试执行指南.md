# AutoRepo 功能测试执行指南

**所有功能已实现完毕！** 现在请按以下步骤进行测试验证。

---

## 📋 测试准备（5 分钟）

### 1. 启动后端服务

```bash
cd backend
uvicorn main:app --reload --port 8001
```

验证：浏览器访问 http://localhost:8001/docs 应显示 FastAPI 文档

### 2. 打开微信开发者工具

1. 打开微信开发者工具
2. 导入项目：`auto-repo/miniprogram`
3. 清除缓存：工具 → 清除缓存 → 清除全部缓存
4. 重新编译：点击「编译」按钮

### 3. 生成测试数据（可选但推荐）

**快速生成跨月份测试数据**：

```bash
cd backend
python generate_test_data.py
```

按提示操作：
1. 选择车辆 ID（或按 Enter 使用第一个）
2. 输入起始里程（或按 Enter 使用 5000）
3. 等待脚本生成 15 条跨 6 个月的测试数据

**手动创建车辆**（如果没有车辆）：
1. 在小程序中点击「添加车辆」
2. 填写车辆信息并保存

---

## ✅ 功能测试（15-20 分钟）

### 测试 1：保养模板系统（5 分钟）

**路径**: 车辆详情页 → 点击「+」按钮 → 创建提交页面

**测试步骤**：
1. 查看页面顶部的模板选择器
2. 横向滚动查看所有 10 个模板
3. 点击「🛢️ 更换机油」模板
4. 观察表单自动填充

**验证点**：
- ✓ 10 个模板全部显示（有图标和名称）
- ✓ 横向滚动流畅
- ✓ 点击模板后：
  - 标题自动填充
  - 类型选择器自动更新
  - 费用字段自动填充
  - 选中的模板高亮显示
  - 显示「已应用模板」提示

**测试不同类型**：
- 点击「🛑 更换刹车片」→ 类型应为「维修」
- 点击「🎵 改装音响」→ 类型应为「改装」

**完成提交**：
- 填写里程数和备注
- 点击提交按钮
- 验证数据保存成功

---

### 测试 2：CSV 导出（5 分钟）

**路径**: 车辆详情页 → 时间线标签页

**前提条件**：车辆至少有 3 条提交记录

**测试步骤**：
1. 点击「📊 导出」按钮
2. 等待「生成中...」提示
3. 在弹出的对话框中点击「分享」
4. 分享给「文件传输助手」
5. 在电脑端下载并用 Excel 打开

**验证点**：

**文件生成**：
- ✓ 1-2 秒内生成完成
- ✓ 显示「导出成功」对话框

**文件内容**（在 Excel 中）：
- ✓ 文件名：`{车辆名}_维保记录_{日期}.csv`
- ✓ 中文字符正确显示（无乱码）
- ✓ 表头：日期、类型、标题、里程(km)、零件费用(元)、人工费用(元)、总费用(元)、备注
- ✓ 数据与应用中的记录一致
- ✓ 总费用 = 零件费用 + 人工费用

**边界测试**：
- 创建一个新车辆（无记录）
- 点击导出 → 应显示「暂无记录可导出」

---

### 测试 3：月度趋势图表（5 分钟）

**路径**: 车辆详情页 → 数据统计标签页

**前提条件**：
- 车辆有跨多个月的提交记录
- 推荐使用 `generate_test_data.py` 生成测试数据

**测试步骤**：
1. 切换到「数据统计」标签页
2. 向下滚动到「趋势分析」部分
3. 查看两个图表：月度花费、里程变化

**验证点**：

**月度花费图表**：
- ✓ 显示最近 6 个月（或实际可用月份）
- ✓ 柱子高度与费用成正比
- ✓ 每个柱下方显示月份（例如：「08月」）
- ✓ 每个柱下方显示金额（例如：「¥450」）
- ✓ 柱子颜色为蓝色渐变

**里程变化图表**：
- ✓ 柱子高度与里程成正比
- ✓ 每个柱下方显示里程（例如：「12500km」）
- ✓ 柱子颜色为深色渐变（与费用图不同）

**数据准确性**：
- 随机选择 2 个月份
- 在「时间线」标签页中查看该月的记录
- 计算总费用和最大里程
- 对比图表显示的数值是否一致

**交互测试**：
- 下拉刷新页面
- 验证趋势图数据更新

---

## 🔍 高级验证（可选，5 分钟）

### 验证 1：自动化验证脚本

在微信开发者工具控制台中执行：

```javascript
const validator = require('./test/feature-validation.js');
validator.runAllValidations();
```

应显示：
```
✓✓✓ ALL VALIDATIONS PASSED ✓✓✓
```

### 验证 2：后端 API 测试

在浏览器中访问（替换 `{repo_id}` 为实际车辆 ID）：

```
http://localhost:8001/api/repos/{repo_id}/trends?months=6
```

验证返回 JSON 格式正确：
```json
{
  "months": [
    {"month": "2025-08", "cost": 450, "mileage": 5200, "count": 2},
    ...
  ],
  "total_months": 6
}
```

### 验证 3：性能测试

**测试响应时间**：
- 模板选择：< 100ms（几乎即时）
- CSV 导出（50 条记录）：< 2 秒
- 趋势图加载：< 500ms
- 页面切换：无明显卡顿

---

## 📝 问题反馈

如果发现任何问题，请按以下格式记录：

**问题描述**：
```
例如：点击「更换机油」模板后，类型选择器未更新
```

**重现步骤**：
```
1. 进入创建提交页面
2. 点击「更换机油」模板
3. 观察类型选择器
```

**预期结果**：
```
类型选择器应自动选中「保养」
```

**实际结果**：
```
类型选择器保持在「维修」
```

**严重程度**：
- [ ] 严重（功能完全无法使用）
- [ ] 一般（功能可用但有明显问题）
- [ ] 轻微（体验问题或边缘情况）

---

## ✅ 测试完成清单

完成以下测试后打勾：

- [ ] 保养模板系统测试通过
- [ ] CSV 导出与分享测试通过
- [ ] 月度趋势图表测试通过
- [ ] 自动化验证脚本通过（可选）
- [ ] 后端 API 测试通过（可选）
- [ ] 性能测试通过（可选）

**全部通过后，即可提交代码！**

---

## 🚀 下一步：提交代码

### 推荐的提交流程

```bash
# 1. 查看所有更改
git status

# 2. 添加所有文件（包括新文件）
git add .

# 3. 提交
git commit -m "feat: 添加保养模板、CSV导出和趋势图表

功能清单：
- 实现 10 个快速填充模板，加速数据录入
- 添加 CSV 导出功能，支持微信分享和 Excel 兼容
- 创建月度趋势可视化（费用 + 里程柱状图）
- 增强搜索过滤功能（类型、里程、日期、全文搜索）
- 优化 UI/UX（渐变、动画、下拉刷新）

代码变更：
- 17 个文件修改 (+565/-45 行)
- 3 个新文件创建
- 0 个破坏性变更

测试状态：已通过完整测试验证"

# 4. 推送到远程（如果需要）
git push origin master
```

---

## 📚 参考文档

详细技术文档请查阅：

- **工作总结.md** - 完整的功能实现总结
- **测试清单.md** - 详细的测试验证清单
- **IMPLEMENTATION_SUMMARY.md** - 英文实现总结

---

**预计测试时间**: 15-20 分钟  
**测试难度**: ⭐⭐☆☆☆（简单）  
**准备工具**: 微信开发者工具、Excel（用于 CSV 验证）

祝测试顺利！🎉
