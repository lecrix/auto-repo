<view class="insights-container">
  
  <!-- 1. Key Metrics Cards -->
  <view class="metrics-grid">
    <view class="metric-card main">
      <view class="label">Total Cost</view>
      <view class="value currency">¥{{stats.total_cost || 0}}</view>
    </view>
    <view class="metric-card">
      <view class="label">Mileage</view>
      <view class="value">{{stats.total_mileage || 0}}<text class="unit">km</text></view>
    </view>
    <view class="metric-card">
      <view class="label">Cost/Km</view>
      <view class="value">¥{{stats.cost_per_km || 0}}</view>
    </view>
  </view>

  <!-- 2. Charts Section -->
  <view class="chart-section">
    <view class="section-title">Cost Composition</view>
    <view class="chart-container">
      <!-- TODO: Integrate uCharts here later -->
      <!-- For now, use simple bar list visualization -->
      <view class="simple-chart" wx:if="{{stats.composition && stats.composition.length > 0}}">
         <view class="chart-row" wx:for="{{stats.composition}}" wx:key="name">
            <view class="row-label">{{item.name}}</view>
            <view class="row-bar-area">
                <view class="row-bar" style="width: {{item.value / stats.total_cost * 100}}%"></view>
            </view>
            <view class="row-val">¥{{item.value}}</view>
         </view>
      </view>
      <view class="empty-state" wx:else>
        No data available
      </view>
    </view>
  </view>
  
  <!-- 3. Upcoming Tasks (Issues) -->
  <view class="chart-section">
    <view class="section-title">Upcoming Tasks</view>
    
    <view class="issue-list" wx:if="{{issues && issues.length > 0}}">
        <view class="issue-item" wx:for="{{issues}}" wx:key="_id">
            <view class="issue-left">
                <view class="issue-status {{item.priority}}"></view>
            </view>
            <view class="issue-content">
                <view class="issue-title">{{item.title}}</view>
                <view class="issue-meta">
                    <text wx:if="{{item.due_mileage}}">Target: {{item.due_mileage}} km</text>
                    <text wx:if="{{item.due_date}}">Due: {{item.due_date}}</text>
                </view>
            </view>
            <view class="issue-action">
                <text class="btn-check">✓</text>
            </view>
        </view>
    </view>

    <view class="empty-state" wx:else>
        No pending tasks.
        <view class="add-hint" bindtap="goToAddIssue">+ Add a reminder</view> 
    </view>
  </view>

</view>
